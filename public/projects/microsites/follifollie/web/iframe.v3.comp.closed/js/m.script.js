/**
 * @author: Arlan Viray
 * @email: arlanv555@gmail.com
 */
$(document).ready(function(){function i(){_this.id.hash=window.location.hash,""!==_this.id.hash&&base64Decode(_this.id.hash.replace("#","")).split("/").length>3?(// error with hash url
$("#contents").append('<div class="errorhash" style="width:'+$(window).width()+"px; height:"+$(window).height()+'px;"><h2>OOPS...</h2><p>This moodboard wasn\'t created on mobile, click below to scrapbook your own summer</p><div class="absolute cursor btnContinue">CONTINUE</div></div>'),$(".btnContinue").bind(j,function(t){window.location.hash="",$(".errorhash").remove(),i()})):(t(),""!==_this.id.hash?(h(parseInt($(_this.obj.main.elem).find("li").length-2)),// tracking
_gaTrackingPageview(_this.urlpath+window.location.hash)):(_this.obj.intro.tween.play(),// tracking
_gaTrackingPageview(_this.urlpath)),g(),$(window).resize(function(){_this.winWidth=$(window).width(),_this.winHeight=$(window).height(),_this.winWidth>_this.winHeight||$("#contents, .row-main li.listmain").css({width:_this.winWidth,height:_this.winHeight})}).resize(),// events
$("#landscapeMessage").bind("touchmove",function(i){i.preventDefault()}),$(".btnBack").bind(j,function(i){f()})),_()}function t(){var i="";i+='<ul class="carousel">',i+='<li class="listmain listintro"></li>',$.each(_this.obj.main.items.products,function(t,e){i+='<li class="listmain listquiz listquiz'+t+'">',i+='<div class="imgholder">',$.each(e.quiz,function(t,e){i+='<div class="col col'+t+'" style="background:url('+e.imgpath+') center center no-repeat; background-color:#fff; background-size:contain;">',i+='<div class="ansoverlay"></div>',i+="</div>"}),i+='<div class="clear-fix"></div>',i+="</div>",i+="</li>"}),i+='<li class="listmain listmoodboard"></li>',i+='<li class="listmain listresults"></li>',i+='<div class="clear-fix"></div>',i+="</ul>",i+='<div class="quiz header"><h2></h2><p></p></div>',i+='<div class="quiz arrows">',i+='<div class="btn back">BACK</div>',i+='<div class="btn next">NEXT</div>',i+="</div>",$(_this.obj.main.elem).empty().html(i),s(),o()}function e(){a(),TweenMax.to($(_this.obj.main.elem).find("ul.carousel"),_this.animDurationFast,{css:{left:-(_this.winWidth*_this.obj.main.items.contentId)},onComplete:a,onCompleteParams:[!0]})}function s(){if($(_this.obj.main.elem).find(".listintro .intro").length<1){for(var i=images="",t=1;t<=_this.obj.intro.images;t++)images+='<img src="images/mobile_intro_'+t+'.png" class="absolute img'+t+'" />';i+='<div class="intro">',i+=images,i+='<div class="absolute unselectable copy">What\'s your summer personality?<br />Find out with Folli Follie</div>',i+='<div class="absolute unselectable head1">Summer</div>',i+='<div class="absolute unselectable head2">State of mind</div>',i+='<div class="absolute cursor btnPlaynow">PLAY NOW</div>',i+="</div>",$(_this.obj.main.elem).find(".listintro").empty().html(i),// events
$(_this.obj.main.elem).find(".btnPlaynow").bind(j,function(i){_this.obj.main.items.contentId++,e(),r(),n(!0),// tracking
_gaTrackingEvent("Clicked","Intro button enter")}),// anim
$.each(_this.obj.intro.anim,function(i,t){_this.obj.intro.tween.add(i>0?TweenMax.from($(".intro").find(_this.obj.intro.anim[i].elem),_this.animDurationFast,{css:_this.obj.intro.anim[i].obj}):TweenMax.from($(".intro").find(_this.obj.intro.anim[i].elem),_this.animDurationFast,{css:_this.obj.intro.anim[i].obj,delay:.25}))})}n(),d(!0)}function o(){$(_this.obj.main.elem).find(".arrows .back").bind(j,function(i){_this.obj.main.items.contentId--,_this.obj.main.items.contentId>0?(r(),l(),// tracking
_gaTrackingEvent("Clicked","Arrow back to Q"+_this.obj.main.items.contentId)):(e(),s(),_this.obj.intro.tween.restart(),// tracking
_gaTrackingEvent("Clicked","Arrow back to start"))}),$(_this.obj.main.elem).find(".arrows .next").bind(j,function(i){void 0!=_this.obj.main.items.quizResultArray[_this.obj.main.items.contentId-1]&&(_this.obj.main.items.contentId++,_this.obj.main.items.contentId<=_this.obj.main.items.products.length?(r(),l(),// tracking
_gaTrackingEvent("Clicked","Arrow right to Q"+_this.obj.main.items.contentId)):(m(),e(),// tracking
_gaTrackingEvent("Clicked","Arrow right to moodboard")))}),// set carousel clicks
$.each($(_this.obj.main.elem).find("ul li.listquiz"),function(i,t){$(t).find(".ansoverlay").bind(j,function(e){$(t).find(".ansoverlay").removeClass("selected"),$(this).addClass("selected"),_this.obj.main.items.quizResultArray[i]=parseInt($(this).parent().index()+1),l(),// console.log(_this.obj.main.items.quizResultArray);
// tracking
_gaTrackingEvent("Clicked","Q"+(i+1)+" selected image"+($(this).parent().index()+1))})})}function n(i){i?setTimeout(function(){$(_this.obj.main.elem).find(".header, .arrows").show(),$(_this.obj.progressbar.elem).show(),l()},250):($(_this.obj.main.elem).find(".header, .arrows").hide(),$(_this.obj.progressbar.elem).hide())}function a(i){_this.obj.main.items.quizEnd||(i?TweenMax.delayedCall(_this.animDurationFast,function(){$(_this.obj.main.elem).find("ul li.listquiz .ansoverlay").css({"pointer-events":"auto"})}):$(_this.obj.main.elem).find("ul li.listquiz .ansoverlay").css({"pointer-events":"none"}))}function l(){void 0==_this.obj.main.items.quizResultArray[_this.obj.main.items.contentId-1]?$(_this.obj.main.elem).find(".arrows .next").fadeTo(0,.25).css({"pointer-events":"none"}):$(_this.obj.main.elem).find(".arrows .next").fadeTo(0,1).css({"pointer-events":"auto"})}function r(){e(),c(),d()}function c(){$(_this.obj.main.elem).find(".header h2").empty().html(_this.obj.main.items.contentId+" OF 10..."),$(_this.obj.main.elem).find(".header p").empty().html(_this.obj.main.items.products[_this.obj.main.items.contentId-1].ques)}function d(i){i?TweenMax.to($(_this.obj.progressbar.elem),0,{css:{left:-$(window).width()}}):TweenMax.to($(_this.obj.progressbar.elem),_this.animDurationFast,{css:{left:-($(window).width()-$(window).width()/_this.obj.main.items.products.length*_this.obj.main.items.contentId)}})}function m(){console.log("End quiz..."),_this.obj.main.items.quizEnd=!0;var i="";$.each(_this.obj.main.items.quizResultArray,function(t,e){i+=e,t<_this.obj.main.items.quizResultArray.length-1&&(i+="-"),_this.obj.main.items.quizCategoryValues.push(_this.obj.main.items.products[t].quiz[e-1].category)});// console.log(url);
// console.log(_this.obj.main.items.quizCategoryArray);
for(var t=1;t<=_this.obj.main.items.quizNumAns;t++)_this.obj.main.items.quizCategoryResults.push({group:t,value:arrayCountValues(t,_this.obj.main.items.quizCategoryValues)});_this.obj.main.items.quizCategoryResults.sort(arraySortDescending);// get results by group.
var e;e=_this.obj.main.items.quizCategoryResults[0].value==_this.obj.main.items.quizCategoryResults[1].value&&_this.obj.main.items.quizCategoryResults[0].value==_this.obj.main.items.quizCategoryResults[2].value?Math.ceil(3*Math.random())-1:_this.obj.main.items.quizCategoryResults[0].value==_this.obj.main.items.quizCategoryResults[1].value?Math.ceil(2*Math.random())-1:0,_this.obj.main.items.quizCategoryOutcome=_this.obj.main.items.quizCategoryResults[e].group;// set url
var s=base64Encode(i+"/"+_this.obj.main.items.quizCategoryOutcome+"/"+(isMobile.any()?"mobile":"others"));window.location.hash=s,n(),g(),b()}function h(i){_this.obj.main.items.contentId=i?i:0,TweenMax.to($(_this.obj.main.elem).find("ul.carousel"),0,{css:{left:-($(window).width()*_this.obj.main.items.contentId)}}),i&&(g(),b())}function u(){var i=window.location.hash.replace("#","");return base64Decode(i).split("/")}function b(){var i=u(),t=backgrounds=locations=products="";$.each(i[0].split("-"),function(i,t){1==_this.obj.main.items.products[i].pos.z&&(backgrounds+='<img src="'+_this.obj.main.items.products[i].quiz[t-1].imgpath+'" class="absolute" style="top:'+_this.obj.main.items.products[i].pos.y+"px; left:"+_this.obj.main.items.products[i].pos.x+"px; width:"+_this.obj.main.items.products[i].pos.s+"px; height:"+_this.obj.main.items.products[i].pos.s+'px" />'),2==_this.obj.main.items.products[i].pos.z&&(locations+='<img src="'+_this.obj.main.items.products[i].quiz[t-1].imgpath+'" class="absolute locations" style="top:'+_this.obj.main.items.products[i].pos.y+"px; left:"+_this.obj.main.items.products[i].pos.x+"px; width:"+_this.obj.main.items.products[i].pos.s+"px; height:"+_this.obj.main.items.products[i].pos.s+'px" />'),3==_this.obj.main.items.products[i].pos.z&&(products+='<img src="'+_this.obj.main.items.products[i].quiz[t-1].imgpath+'" class="absolute products" style="top:'+_this.obj.main.items.products[i].pos.y+"px; left:"+_this.obj.main.items.products[i].pos.x+"px; width:"+_this.obj.main.items.products[i].pos.s+"px; height:"+_this.obj.main.items.products[i].pos.s+'px" />')}),t+='<div class="moodboard">',t+=backgrounds+locations+products,t+='<div class="thisheader"><span>Your</span>Summer</div>',t+="</div>",$(_this.obj.main.elem).find(".listmoodboard").empty().html(t),p()}function p(){var i=u();// tracking
_gaTrackingEvent("Moodboard outcome",_this.obj.main.items.categoryTitles[parseInt(i[1])-1].title);var t=_this.obj.main.items.categoryTitles[i[1]-1].title.split(" "),e="";e+='<div id="scrollerwrapper">',e+='<div id="scroller" class="finalcolum">',e+='<div class="fcol results">',e+='<div class="thisheader"><span>'+t[0]+"</span><br />"+t[1]+"</div>",e+='<div class="info">',e+=_this.obj.main.items.categoryTitles[i[1]-1].copy,e+='<img src="images/mobile_outcome'+i[1]+'.png" />',e+="<strong>WHY NOT TRY...</strong>",e+="<ul>",$.each(_this.obj.main.items.categoryTitles[i[1]-1].bullets,function(i,t){e+="<li>"+t+"</li>"}),e+="</ul>",e+="</div>",e+="</div>",e+='<div class="fcol win">',e+='<h2 style="padding-top:280px;"><span>Competition</span><br />is now closed...</h2>',/*
					html+= '<h2><span>WIN</span> a holiday</h2>';
					html+= '<p>for two to the gorgeous Greek island of Santorini â€“ just enter your details below</p>';
					html+= '<div class="form">';
						html+= '<div class="row row1"><input type="text" class="field" name="uName"></div>';
						html+= '<div class="row row2"><input type="text" class="field" name="uEmail"></div>';
						html+= '<div class="row row3"><div class="checkbox"></div>Please tick here if you wish to receive info and offers from Folli Follie&reg;</div>';
						html+= '<div class="row row4"><div class="checkbox"></div>Please tick to confirm you have read our <a href="#" id="tandc">terms and conditions</a></div>';
					html+= '</div>';
					html+= '<div class="absolute cursor btnSubmit">SUBMIT</div>';
					html+= '<div class="termsandconditions">';
						html+= '<h2><span>TERMS AND CONDITIONS</span></h2>';
						html+= '<p>Open to UK residents\' aged 18 and over. To enter submit your name and email address. Prize is a 7-night stay for two in Santorini with accommodation valid for stays from 1st May 2014 - 31st October 2014, subject to availability. The prize is to be booked with Thomas Cook. Flights are return economy tickets from London to Santorini, airline chosen by Thomas Cook. The competition opens May 6th 2014 and will end on 13th June 2014. Answers received after the closing date will not be considered. Hearst will choose the winner via prize draw from all eligible entries made during the entry period. Folli Follie will notify the winner via email within 14 days after the close date. Hearst reserves the right to amend the terms and conditions for this competition at any time without notice.<br /><br />See website for<br /><a href="http://www.hearst.co.uk/magazines/Terms-and-Conditions.html" target="_blank" style="text-decoration:underline;">full terms and conditions</a></p>';
						html+= '<div class="absolute cursor btnClose"></div>';
					html+= '</div>';
					*/
e+="</div>",e+='<div class="fcol share">',e+="<h2><span>THANKS</span><br />Share your summer!</h2>",e+="<p>Click below to share your <strong>#summerstateofmind</strong> with friends and invite them to play to win</p>",e+='<div class="icons">',e+='<img src="images/share_outcome_twitter.png" class="shareTwitter" />',e+='<img src="images/share_outcome_facebook.png" class="shareFacebook" />',e+='<img src="images/share_outcome_mail.png" class="shareMail" />',e+="</div>",e+="</div>",e+='<div style="padding-bottom:340px;"></div>',e+="</div>",e+="</div>",$(_this.obj.main.elem).find(".listresults").empty().html(e),$("#scrollerwrapper").css({height:$(window).height()}),setTimeout(function(){w=new IScroll("#scrollerwrapper",{click:!0}),w.on("scrollEnd",function(){$(_this.obj.navigation.elem).find(".circle").removeClass("active"),this.y>-1200&&$(_this.obj.navigation.elem).find(".btnReveal").addClass("active"),this.y>-2300&&this.y<-1200&&$(_this.obj.navigation.elem).find(".btnWin").addClass("active"),this.y<-2300&&$(_this.obj.navigation.elem).find(".btnShare").addClass("active")})},1500);// sharing
var s=$("#scrollerwrapper .share"),o=encodeURIComponent("FolliFollie"),n=encodeURIComponent("I've discovered my #summerstateofmind."),a=encodeURIComponent("Find yours for the chance to win a holiday to Santorini with Folli Follie."),l=encodeURIComponent(_this.url);$(s).find(".shareTwitter").click(function(){console.log(window.parent.location.hash);var i=l+"%23"+window.parent.location.hash.replace("#",""),t=encodeURIComponent("Find yours for the chance to win a holiday to Santorini with @FolliFollie_UK");windowOpen("https://twitter.com/share?url="+i+"&text="+n+" "+t,!0),// tracking
_gaTrackingEvent("Clicked","Moodboard Twitter")}),$(s).find(".shareFacebook").click(function(){var i=l+"%23"+window.parent.location.hash.replace("#",""),t=encodeURIComponent(_this.imgdir+"mobile/icon-196x196.png");windowOpen("https://www.facebook.com/dialog/feed?app_id=145634995501895&display=page&name="+o+"&caption="+n+"&description="+a+"&picture="+t+"&link="+i+"&redirect_uri=https://www.facebook.com/",!0),// tracking
_gaTrackingEvent("Clicked","Moodboard Facebook")}),$(s).find(".shareMail").click(function(){var i=l+"%23"+window.parent.location.hash.replace("#",""),t=encodeURIComponent("Summer State of Mind");windowLocation("mailto:?subject="+o+" "+t+"&body="+n+" "+a+"%0D%0A%0D%0A"+i),// tracking
_gaTrackingEvent("Clicked","Moodboard Mail")}),// win
v(),$("#tandc").bind(j,function(i){$(".termsandconditions").is(":hidden")?($(".termsandconditions").fadeIn(),// tracking
_gaTrackingEvent("Clicked","Terms and Conditions")):$(".termsandconditions").fadeOut()}),$(".termsandconditions .btnClose").bind(j,function(i){$(".termsandconditions").fadeOut()}),// checkbox
$("#scrollerwrapper .form .row3, #scrollerwrapper .form .row4").bind(j,function(i){$(this).find(".checkbox").hasClass("active")?$(this).find(".checkbox").removeClass("active"):$(this).find(".checkbox").addClass("active")})}function v(){var i=$("#scrollerwrapper .win"),t="INVALID EMAIL",e=$(i).find("input[name=uName]"),s=$(i).find("input[name=uEmail]"),o=$(i).find(".row3 .checkbox"),n=$(i).find(".row4 .checkbox"),a=$(i).find(".row4");e.val("YOUR NAME").removeClass("fieldHighlightError").focus(function(){$(this).val("")}),s.val("YOUR EMAIL").removeClass("fieldHighlightError").focus(function(){$(this).val("")}),a.removeClass("fieldHighlightError"),$(i).find(".btnSubmit").bind(j,function(l){if(""===e.val()||"YOUR NAME"===e.val())return e.addClass("fieldHighlightError"),!1;if(e.removeClass("fieldHighlightError"),!isValidEmailAddress(s.val()))return s.val(t).addClass("fieldHighlightError"),!1;if(s.removeClass("fieldHighlightError"),!$(n).hasClass("active"))return a.addClass("fieldHighlightError"),!1;a.removeClass("fieldHighlightError"),// thank you
$(i).find(".form").empty().html('<div class="thankyou">Thank you for entering the competition...</div>'),$(this).remove();// tracking - send to ga
var r=base64Encode(e.val()+"***"+s.val()+"***"+($(o).hasClass("active")?"yes":"no")+"***"+($(n).hasClass("active")?"yes":"no"));_gaTrackingEvent("Win a holiday",r)})}function f(){$(".btnBack").is(":hidden")?($(".btnBack").show(),_this.obj.main.items.contentId++,TweenMax.to($(_this.obj.navigation.elem).find(".btnReveal"),_this.animDurationFast,{css:{left:"5.5%"}}),$(_this.obj.navigation.elem).find(".circle").fadeIn()):($(".btnBack").hide(),_this.obj.main.items.contentId--,TweenMax.to($(_this.obj.navigation.elem).find(".btnReveal"),_this.animDurationFast,{css:{left:"41.5%"},delay:_this.animDurationNorm}),$(_this.obj.navigation.elem).find(".btnWin, .btnShare, .btnShop").fadeOut(),$(_this.obj.navigation.elem).find(".circle").removeClass("active")),e()}// navigation
function g(i){if($(_this.obj.navigation.elem).find(".circle").length<1){var t="";t+='<div class="circle btnReveal"><p></p></div>',t+='<div class="circle btnWin"><p>WIN</p></div>',t+='<div class="circle btnShare"><p>SHARE</p></div>',t+='<div class="circle btnShop"><p>SHOP</p></div>',$(_this.obj.navigation.elem).empty().html(t),$.each($(_this.obj.navigation.elem).find(".circle"),function(i,t){$(t).bind(j,function(e){"PLAY"===$(t).find("p").text()?(h(),g(!0),window.location.hash="",_this.obj.intro.tween.play()):($(this).hasClass("btnShop")||($(_this.obj.navigation.elem).find(".circle").removeClass("active"),$(this).addClass("active")),_this.obj.main.items.contentId<$(_this.obj.main.elem).find("ul.carousel li.listmain").length-1?(f(),w.scrollToElement(document.querySelector("#scroller .fcol:nth-child(1)"))):$(this).hasClass("btnShop")?windowOpen("http://www.follifollie.co.uk/summerstateofmind"):w.scrollToElement(document.querySelector("#scroller .fcol:nth-child("+(i+1)+")"))),// tracking
_gaTrackingEvent("Clicked",$(this).find("p").text())})})}else i?TweenMax.to($(_this.obj.navigation.elem),_this.animDurationFast,{css:{bottom:-164}}):TweenMax.to($(_this.obj.navigation.elem),_this.animDurationNorm,{css:{bottom:90}});$(_this.obj.navigation.elem).find(".btnReveal p").empty().html(_this.obj.main.items.quizEnd?"REVEAL":"PLAY")}// footer
function _(){setTimeout(function(){$(_this.obj.footer.elem).empty().html('<div class="row"><img src="images/logo_elle.png" class="elle" /><span>In association with</span><img src="images/logo.png" class="logo" /></div>'),$(_this.obj.footer.elem).find(".elle").bind(j,function(i){var t="http://www.elleuk.com/";windowOpen(t),// tracking
_gaTrackingEvent("Clicked","Logo Elle")}),$(_this.obj.footer.elem).find(".logo").bind(j,function(i){windowOpen("http://www.follifollie.co.uk/summerstateofmind"),// tracking
_gaTrackingEvent("Clicked","Logo FolliFollie")})},250)}var w,j="ontouchstart"in document.documentElement?"touchstart":"click";i()});